---
import { Image } from "astro:assets";

import media2 from "../assets/media2.webp";
import media3 from "../assets/nasdaq-billboard.webp";
import media4 from "../assets/Boston 2025-3786.jpg";
import media5 from "../assets/Boston 2025-3808.jpg";

const base = import.meta.env.BASE_URL;

const mediaItems = [
  {
    type: "video",
    src: `${base}videos/surgeon-general-meeting.mp4`,
    poster: `${base}images/surgeon-general-meeting-poster.webp`,
    caption: "Video: Professional public health meeting",
    fit: "cover",
  },
  {
    type: "image",
    src: media2,
    alt: "Television interview with Dr. Okonkwo",
    caption: "Television interview",
    fit: "cover",
  },
  {
    type: "image",
    src: media3,
    alt: "Nasdaq billboard featuring Dr. Okonkwo",
    caption: "Nasdaq billboard",
    fit: "contain", // tall image
    expandable: true,
  },
  {
    type: "image",
    src: media4,
    alt: "Dr. Okonkwo speaking at a community event",
    caption: "Community engagement",
    fit: "cover",
  },
  {
    type: "image",
    src: media5,
    alt: "Dr. Okonkwo participating in a professional panel",
    caption: "Professional panel",
    fit: "cover",
  },
];


---

<section class="border-y border-slate-200 bg-slate-50">
  <!-- <a
    href={`${base}about-dr-okonkwo`}
    class="block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-600"
    aria-label="Learn more about Dr. Okonkwo"
  > -->
  <div class="mx-auto max-w-7xl px-4 py-8">
    <div class="text-center space-y-2">
      <p class="text-xs font-semibold uppercase tracking-wide text-brand-700">
        Community & Media
      </p>
      <h3 class="text-base font-semibold text-slate-900">
        Sharing pediatric expertise beyond the clinic
      </h3>
      <p class="mx-auto max-w-xl text-sm text-slate-600">
        Dr. Okonkwo is regularly invited to speak and share insights on pediatric
        health, holistic care, and parent education.
      </p>
    </div>


    <!-- Media carousel -->
    <div class="mt-6">
      <div class="swiper credibility-swiper">
        <div class="swiper-wrapper">

          {mediaItems.map((item) => (
            <div class="swiper-slide">
              <figure class={`space-y-2 ${item.fit === "contain" ? "flex flex-col items-center justify-center h-full" : ""}`}>

                <!-- Media container -->
                <div
                  class={`overflow-hidden rounded-xl ring-brand-700/10 
                    ${item.fit === "contain"
                      ? "ring-0 bg-slate-100 max-w-45 max-h-50 sm:max-w-45 sm:max-h-57 flex items-center justify-center"
                      : "aspect-video ring-1 bg-slate-100"}`}
                >

                  {item.type === "video" ? (
                    <video
                      controls
                      preload="metadata"
                      class="h-full w-full object-cover aspect-video"
                      poster={item.poster}
                    >
                      <source src={typeof item.src === "string" ? item.src : ""} type="video/mp4" />
                      Your browser does not support the video tag.
                    </video>
                  ) : (
                    <Image
                      src={item.src}
                      alt={item.alt}
                      class={item.fit === "contain"
                        ? "h-full w-auto object-contain "
                        : "h-full w-full object-cover"}
                      loading="lazy"
                    />
                  )}
                </div>

                <!-- Caption -->
                <figcaption class="text-xs text-slate-500">
                  {item.caption}
                </figcaption>
              </figure>
            </div>
          ))}

        </div>

        <!-- Pagination -->
        <div class="swiper-pagination mt-4"></div>

        <!-- Navigation -->
        <button
          type="button"
          class="swiper-button-prev"
          aria-label="Previous"
        ></button>
        <button
          type="button"
          class="swiper-button-next"
          aria-label="Next"
        ></button>
      </div>


          

      <!-- <p class="mt-3 text-xs text-slate-500 text-center">Swipe to view highlights.</p> -->
    </div>

    <script>
      import Swiper from "swiper";
      import { Navigation, Pagination, Keyboard, A11y } from "swiper/modules";

      const el = document.querySelector(".credibility-swiper");

      const pauseAllVideos = () => {
        if (!el) return;
        el.querySelectorAll("video").forEach((v) => {
          try { v.pause(); } catch {}
        });
      };

      if (el) {
        const swiper = new Swiper(el, {
          modules: [Navigation, Pagination, Keyboard, A11y],
          slidesPerView: 1,
          spaceBetween: 16,
          loop: true,
          speed: 650,
          keyboard: { enabled: true },
          pagination: { el: el.querySelector(".swiper-pagination"), clickable: true },
          navigation: {
            nextEl: el.querySelector(".swiper-button-next"),
            prevEl: el.querySelector(".swiper-button-prev"),
          },
          a11y: { enabled: true },
          breakpoints: {
            640: { slidesPerView: 2, spaceBetween: 18 },
            1024: { slidesPerView: 3, spaceBetween: 20 },
          },
          on: {
            slideChangeTransitionStart: () => pauseAllVideos(),
          },
        });

        // Also pause videos if user clicks outside controls, etc.
        el.addEventListener("focusout", pauseAllVideos);
      }
    </script>
    

    <div class="mt-4 text-center">
      <a
        href={`${base}about-dr-okonkwo`}
        class="text-xs font-medium text-brand-700 underline-offset-4 hover:underline
              focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-600"
      >
        Learn more about Dr. Okonkwo
      </a>
    </div>
  </div>
</section>
